<html>

<body onload="translate();">
    <div>
        <!--Statische Komponente-->
        <p>Statisch</p>
    </div>
    <div id="test">
        <!--Dynamische Komponente-->
        <button onClick="refresh()">Inhalt aktualisieren</button>
    </div>
    <div id="testEingabe">
        <!--Dynamische Komponente 2-->
        <input type="text" id="Komponente">
        <input type="text" id="Status">
        <button
            onClick="submit(document.getElementById('Komponente').value, document.getElementById('Status').value)">Hinzufuegen</button>
        <br><br><br>
        <img src="pic_ajax.gif">
        <p>Source: https://www.w3schools.com/xml/ajax_intro.asp</p>

    </div>
    <p id="hello" data-i18n="hello"></p>
</body>

<script>
    function refresh() {
        // Erstellen eines HTTP Requests
        // senden des HTTP Requests an den Server
        // Erhalten der Response vom Server (=json)
        let xhttp = new XMLHttpRequest();

        xhttp.open("GET", "http://localhost:3000/components", true);

        xhttp.onload = function () {
            if (this.readyState == 4 && this.status == 200) {
                // Prozessieren der Response
                let json = JSON.parse(this.responseText);

                // aktualisieren der View
                for (i = 0; i < json.length; i++) {
                    document.querySelector("#test").innerHTML = document.querySelector("#test").innerHTML + "<br>" + json[i].component + " Status = " + json[i].info.status;
                }
            }
        };
        
        xhttp.send();

    }

    function submit(component, status) {
        // HTTP call, um die Ã„nderungen im Backend zu speichern
        // Back-End antwortet mit Response Code (z.B. 200 OK)
        // HTTP request, um die aktuellen Daten zu bekommen
        // Aktualisieren der View

        let xhttp = new XMLHttpRequest();
        xhttp.open("POST", "http://localhost:3000/components", true);
        xhttp.setRequestHeader("Content-Type", "application/json");

        xhttp.onreadystatechange = function() {
    if (this.readyState === XMLHttpRequest.DONE && (this.status === 200 || this.status === 201)) {
        // Neuladen der Daten
        refresh();
    }
}

  let params = `{"component": "${component}", "info": {"status": "${status}", "requiredAvailability":"99%"}}`;
  // let params = JSON.stringify(param);

        xhttp.send(params);

        refresh();
    }

</script>

<script type="module">
    import i18next from 'https://deno.land/x/i18next/index.js'
    import Backend from 'https://deno.land/x/i18next_fs_backend/index.js'
   
   function translate(){
    i18next
  //.use(Backend)
  .init({
    /*backend: {
      loadPath: __dirname + 'i18n/de.json',
    }*/
    lng: 'de',
    resources: {
    de: {
      translation: {
        "hello": "Hallo Welt"
      }
    }
  },
    fallbackLng: 'de',
    preload: ['de'],
  }), function(err, t) {
  // initialized and ready to go!
  document.getElementById('output').innerHTML = i18next.t('hello');
};
   }
</script>

</html>